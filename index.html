<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gondol! Game</title>
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    background: #67ffd9;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    padding-top: 10px;
  }

  h1 { margin-bottom: 5px; }

  .info {
    display: flex;
    gap: 20px;
    margin-bottom: 10px;
    font-size: 24px;
    font-weight: bold;
  }

  /* ---------------------------- */
  /*   √ÅREA DO JOGO + REGRAS      */
  /* ---------------------------- */
  .game-area {
    display: flex;
    gap: 20px;
    align-items: flex-start;
    justify-content: center;   /* impede esticar */
    width: auto;               /* tamanho natural */
  }

  /* ---------------------------- */
  /*      MATRIZ DO GONDOL        */
  /* ---------------------------- */
  .container {
    display: grid;
    grid-template-columns: 40px repeat(3, 80px);
    grid-template-rows: 40px repeat(3, 80px);
    gap: 8px;
    align-items: center;
    justify-items: center;
    background: #FFB347;
    padding: 12px;
    border-radius: 12px;
    width: max-content;   /* üî¥ impede ficar larga */
  }

  .header, .side {
    font-weight: bold;
    font-size: 26px;
    opacity: 0;
    transform: scale(0.3);
    transition: all 0.5s ease;
  }
  .header.show, .side.show {
    opacity: 1;
    transform: scale(1.1);
    color: #0044cc;
    text-shadow: 0 0 10px #00e6e6;
  }

  .cell {
    width: 80px;
    height: 80px;
    border-radius: 10px;
    font-size: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
    transition: 0.2s;
    background: white;
  }

  .palette {
    margin-top: 20px;
  }

  .number {
    display: inline-block;
    width: 50px;
    height: 50px;
    background: #80ff00;
    color: black;
    border-radius: 50%;
    line-height: 50px;
    font-size: 30px;
    margin: 5px;
    cursor: pointer;
    transition: 0.2s;
  }
  .number:hover {
    background: #32e625;
    transform: scale(1.1);
  }

  .button-row {
    display: flex;
    gap: 12px;
    margin-top: 10px;
    justify-content: center;
    flex-wrap: wrap;
  }

  button {
    padding: 8px 16px;
    font-size: 18px;
    background: #E64A19;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.2s;
  }
  button:hover { background: #32e625; }

  #message {
    margin-top: 10px;
    font-weight: bold;
    font-size: 18px;
  }

  select {
    margin-top: 10px;
    font-size: 18px;
    padding: 5px;
    border-radius: 8px;
    border: 2px solid #E64A19;
  }

  /* ---------------------------- */
  /*        PAINEL DE REGRAS      */
  /* ---------------------------- */
  #rules-box {
    width: 260px;
    padding: 10px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 3px 3px 8px rgba(0,0,0,0.3);
    text-align: left;
    font-size: 18px;
    display: none; /* come√ßa escondido */
  }

</style>
</head>
<body>

<h1>GONDOL! GAME üé≤</h1>

<div class="info">
  <div>‚è±Ô∏è Time: <span id="tempo">0:00</span></div>
  <div>üèÜ Best Time: <span id="recorde">--</span></div>
</div>

<div>
  <label for="difficulty">Difficulty: </label>
  <select id="difficulty" onchange="newChallenge()">
    <option value="easy">Easy</option>
    <option value="medium">Medium</option>
    <option value="hard">Hard</option>
  </select>
</div>

<!-- ---------------------- -->
<!--   MATRIZ + REGRAS      -->
<!-- ---------------------- -->
<div class="game-area">
  
  <div class="container" id="container"></div>

  <div id="rules-box">
    <h3>üìò Gondol Rules</h3>
    <p>‚Ä¢ Only numbers from 1 to 9, without repeating.</p>
    <p>‚Ä¢ The sum of the rows and columns results in the values ‚Äã‚Äãshown in bold.</p>
    
  </div>

</div>

<div class="palette" id="palette"></div>

<div class="button-row">
  <button onclick="checkSolution()">Check</button>
  <button onclick="newChallenge()">New Challenge</button>
  <button id="soundToggle">üîä Sound On</button>
  <button onclick="toggleRules()">üìò Rules</button>
</div>

<p id="message"></p>

<script>
const container = document.getElementById('container');
const palette = document.getElementById('palette');
const message = document.getElementById('message');
const tempoEl = document.getElementById('tempo');
const recordEl = document.getElementById('recorde');
const soundToggle = document.getElementById('soundToggle');

let selectedNumber = null;
let board = Array(3).fill().map(()=>Array(3).fill(null));
let solution = Array(3).fill().map(()=>Array(3).fill(0));
let rowTargets = [0,0,0];
let colTargets = [0,0,0];
let tempo = 0;
let interval = null;
let gameActive = false;
let soundEnabled = true;

let bestTime = localStorage.getItem("gondolBestTime")
                ? parseInt(localStorage.getItem("gondolBestTime"))
                : null;

function formatTime(t){
  const min = Math.floor(t / 60);
  const sec = (t % 60).toString().padStart(2, '0');
  return `${min}:${sec}`;
}

if(bestTime !== null){
  recordEl.textContent = formatTime(bestTime);
}

let ctx = new (window.AudioContext || window.webkitAudioContext)();

function playNote(freq, dur=0.2) {
  if (!soundEnabled) return;
  let o = ctx.createOscillator();
  let g = ctx.createGain();
  o.connect(g);
  g.connect(ctx.destination);
  o.type = "square";
  o.frequency.value = freq;
  g.gain.setValueAtTime(0.08, ctx.currentTime);
  o.start();
  o.stop(ctx.currentTime + dur);
}

function startTimer() {
  if (interval) clearInterval(interval);
  tempo = 0;
  tempoEl.textContent = "0:00";
  interval = setInterval(() => {
    tempo++;
    tempoEl.textContent = formatTime(tempo);
  }, 1000);
}

function generateBoard() {
  const nums = [1,2,3,4,5,6,7,8,9].sort(()=>Math.random()-0.5);
  solution = [nums.slice(0,3), nums.slice(3,6), nums.slice(6,9)];
  rowTargets = solution.map(r => r.reduce((a,b)=>a+b,0));
  colTargets = [0,1,2].map(c => solution[0][c]+solution[1][c]+solution[2][c]);

  board = Array(3).fill().map(()=>Array(3).fill(null));

  const diff = document.getElementById('difficulty').value;
  let revealCount = diff==='easy'?4:(diff==='medium'?2:0);
  let revealed = [];

  while (revealCount>0) {
    let r = Math.floor(Math.random()*3);
    let c = Math.floor(Math.random()*3);
    if (!revealed.some(p=>p[0]===r && p[1]===c)) {
      board[r][c] = solution[r][c];
      revealed.push([r,c]);
      revealCount--;
    }
  }

  renderBoardWithEffect();
  message.textContent = '';
  startTimer();
  gameActive = true;
}

function renderBoardWithEffect() {
  container.innerHTML = '';
  container.appendChild(document.createElement('div'));

  colTargets.forEach((target, i) => {
    const h = document.createElement('div');
    h.className = 'header';
    h.textContent = target;
    container.appendChild(h);
    setTimeout(() => { h.classList.add('show'); playNote(440 + i*60); }, 400 * i);
  });

  rowTargets.forEach((target, r) => {
    const s = document.createElement('div');
    s.className = 'side';
    s.textContent = target;
    container.appendChild(s);
    setTimeout(() => { s.classList.add('show'); playNote(600 - r*70); }, 400 * (r + 3));

    for(let c=0;c<3;c++){
      const cell=document.createElement('div');
      cell.className='cell';
      cell.textContent=board[r][c]??'';
      cell.onclick=()=>{
        if(board[r][c]===selectedNumber){board[r][c]=null;}
        else if(selectedNumber!==null && !board.flat().includes(selectedNumber)){
          board[r][c]=selectedNumber;
        }
        renderBoardWithEffect();
      };
      container.appendChild(cell);
    }
  });
}

function createPalette(){
  palette.innerHTML='';
  for(let i=1;i<=9;i++){
    const n=document.createElement('div');
    n.className='number';
    n.textContent=i;
    n.onclick=()=>{
      selectedNumber=i;
      document.querySelectorAll('.number').forEach(el=>el.style.background='#80ff00');
      n.style.background='#32e625';
      playNote(300+i*30);
    };
    palette.appendChild(n);
  }
}

function checkSolution(){
  let correct=true;
  for(let r=0;r<3;r++){
    if(board[r].reduce((a,b)=>a+(b||0),0)!==rowTargets[r]) correct=false;
  }
  for(let c=0;c<3;c++){
    if((board[0][c]||0)+(board[1][c]||0)+(board[2][c]||0)!==colTargets[c]) correct=false;
  }
  if(correct){
    clearInterval(interval);

    if(bestTime === null || tempo < bestTime){
        bestTime = tempo;
        localStorage.setItem("gondolBestTime", bestTime);
        recordEl.textContent = formatTime(bestTime);
        message.textContent = "üèÜ NEW RECORD! Great job!";
    } else {
        message.textContent = "‚úÖ Correct! Congratulations!";
    }

    playNote(880,0.3);
  } else {
    message.textContent="‚ùå Not yet. Try again!";
    playNote(220,0.2);
  }
}

soundToggle.onclick = () => {
  soundEnabled = !soundEnabled;
  soundToggle.textContent = soundEnabled ? 'üîä Sound On' : 'üîá Sound Off';
};

function newChallenge(){
  generateBoard();
}

function toggleRules(){
  const box = document.getElementById("rules-box");
  box.style.display = (box.style.display === "none") ? "block" : "none";
}

createPalette();
newChallenge();
</script>
</body>
</html>
